
# EMS监控系统 - 项目架构说明 (2025-06-28)

## 核心模块组成
- **数据存储层**：mysql_storage.py 实现MySQL数据库连接与数据持久化
- **数据处理层**：data_processing.py 负责实时数据处理与存储调度
- **控制逻辑层**：emsContronl.py 实现充电放电控制策略
- **UI交互层**：ui_window.py 提供图形化监控界面

## 关键技术特性
- 数据库连接池管理与自动重连机制
- 数据表自动创建与结构维护
- 单例模式确保资源高效利用
- 模块化设计支持功能扩展

---

20250628  新重建拆开模块版，运行成功，只是UI变了；

系统设计步骤：
1.登录EMS管理后台：http://ems.hy-power.net:8114/dashboard/index
     --登录账号：BAIYILED01  
     --登录密码：123456789
     --登录账号:WC0001  
     --登录密码：123456789
     --验证码：需要系统自动识别，如果识别三次失败，请提后台验证码图片由供人工输入

说明：
   -先实现第1步后，再来实现第2步;
   -第1步用有窗口的方式来实现，可以实时观察数据;


2.获取主页menu list --固定的websocket token

3.建立连接


第4步：监控关键数据SOC
在ems_websocket_client.py程序中的更新数据的地方加一个调用外部监控模块：F:\360Downloads\BaiduNetdiskDownload\WicToolDemo\autoRunBY-EMS\emsContronl.py
然后将412001056-SOC、412001051-簇电池簇状态、412001053-簇组电流、409001067-三相实时有功功率(KW)、413001100-柜内温度(℃) 这些数据传递到模块中，然后分别设计判断方法，分别判断数据及相关处理，

现在数据显示和监视主页设计好了，然后我需要在F:\360Downloads\BaiduNetdiskDownload\WicToolDemo\autoRunBY-EMS\emsContronl.py 这里面设计一个监控模块方法，在主程序中循环调用，主页接收一次数据，就调用一次这个外部方法，调用的时候将上述4个参数和主页设置的6个参数(充电开始时间和结束时间、放电开始和接收时间、SCO上限和下限)都传入这个方法中，你先实现这个方法，然后安排在主程序的合适位置，先实现这个模块调用已经传参先。

判断逻辑：

根据充电时间段和放电时间段，一直循环判断当前处于充电或放电阶段中：
充电时间阶段：如果没有启动充电，那么做启动充电操作，同时判断充电SOC值如果大于等于SOC上限设置值时，那么做停止充电。
放电时间阶段：如果没有启动放电，那么做启动放电操作，同时判断充电SOC值如果小于等于SOC下限设置值时，那么做停止放电操作。 

# EMS监控系统使用说明

## 环境要求
- Python 3.8+
- Chrome浏览器

## 安装步骤
1. 安装依赖包：
```bash
pip install -r requirements.txt
```

2. 运行程序：
```bash
先进入虚拟环境
.\venv\Scripts\activate
再运行程序
python ems_monitor_client.py
```
打包exe
```bash
pyinstaller ems_monitor_client.spec
执行打包后的程序
.\dist\ems_monitor_client\ems_monitor_client.exe
## 功能说明
1. 自动登录EMS管理后台
2. 自动识别验证码（失败后支持人工输入）
3. 实时获取并显示仪表盘数据
4. 提供图形界面，方便监控和操作

## 使用方法
1. 点击"启动监控"按钮开始监控
2. 程序会自动进行登录和数据获取
3. 如果验证码识别失败三次，会弹出输入框请求手动输入
4. 可以随时点击"停止监控"按钮结束监控
5. 所有操作日志都会实时显示在主界面
